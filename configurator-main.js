(this["webpackJsonpcanvas-configurator"]=this["webpackJsonpcanvas-configurator"]||[]).push([[0],{121:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(49),o=a.n(r),c=(a(54),a(5)),s=a(6),l=a(8),d=a(7),u=(a(55),a(13)),h=a(9),m=a(14),g=a(30),p=a.n(g),f=a(16),v=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).shapeRef=i.a.createRef(),e.trRef=i.a.createRef(),e.state={slicedImage:null},e.handleImageColorChange=function(){e.props.colorChoice&&("bw"===e.props.colorChoice?e.shapeRef.current.filters([p.a.Filters.Grayscale]):e.shapeRef.current.filters([]),e.shapeRef.current.cache())},e}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(){this.props.isSelected&&(this.trRef.current.nodes([this.shapeRef.current]),this.trRef.current.getLayer().batchDraw()),this.handleImageColorChange()}},{key:"componentDidMount",value:function(){this.handleImageColorChange()}},{key:"render",value:function(){var e=this.props,t=e.imageProps,a=e.isSelected,n=e.onSelect,r=e.onChange,o=e.uploadedImage,c=e.colorChoice,s=this.shapeRef,l=this.trRef,d=document.getElementById("canvas-stage").getBoundingClientRect();return i.a.createElement(i.a.Fragment,null,i.a.createElement(h.Image,Object.assign({image:o,onClick:n,onTap:n,ref:s},t,{draggable:!0,dragBoundFunc:function(e){return e=Object(f.a)(d,t,e)},colorChoice:c,onDragEnd:function(e){r(Object(m.a)(Object(m.a)({},t),{},{x:e.target.x(),y:e.target.y()}))},onTransformEnd:function(e){var a=s.current,n=a.scaleX(),i=a.scaleY();a.scaleX(1),a.scaleY(1),r(Object(m.a)(Object(m.a)({},t),{},{x:a.x(),y:a.y(),width:Math.max(5,a.width()*n),height:Math.max(a.height()*i)}))}})),this.state.slicedImage&&i.a.createElement(h.Image,{image:this.state.slicedImage,x:0,y:0,width:60,height:460}),a&&i.a.createElement(h.Transformer,{ref:l,boundBoxFunc:function(e,t){return t.width<5||t.height<5?e:t}}))}}]),a}(i.a.Component),C=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.slicedImage,a=e.slicedImageTop,n=e.slicedImageBottom,r=e.slicedImageRight,o=e.outerCanvas,c=e.rootElemDimensions,s=e.formatRatio,l=e.canvasPadding,d=c.height/s+2*l;return i.a.createElement(h.Layer,null,t&&i.a.createElement(h.Image,{image:t,x:0,y:l,width:c.width,height:d-2*l,opacity:o.opacity}),a&&i.a.createElement(h.Image,{image:a,x:l,y:0,width:c.width,height:c.height,opacity:o.opacity}),r&&i.a.createElement(h.Image,{image:r,x:c.width+l,y:l,width:l,height:d-2*l,opacity:o.opacity}),n&&i.a.createElement(h.Image,{image:n,x:l,y:d-2*l,width:c.width,height:d,opacity:o.opacity}))}}]),a}(n.Component),b=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.rootElemDimensions,a=e.formatRatio,n=e.canvasPadding,r=e.colorChoice,o=t.height/a+2*n;return i.a.createElement(h.Layer,null,i.a.createElement(h.Rect,{x:n,y:0,width:t.width,height:o,fill:r,stroke:r,strokeWidth:0}),i.a.createElement(h.Rect,{x:0,y:n,width:t.width+2*n,height:o-2*n,fill:r,stroke:r,strokeWidth:0}))}}]),a}(n.Component),y=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.slicedImage,a=e.slicedImageTop,n=e.slicedImageBottom,r=e.slicedImageRight,o=e.outerCanvas,c=e.rootElemDimensions,s=e.formatRatio,l=e.canvasPadding,d=c.height/s+2*l;return i.a.createElement(h.Layer,null,t&&i.a.createElement(h.Image,{image:t,x:0,y:l,width:l,height:d-2*l,opacity:o.opacity,scaleX:-1,offsetX:l}),r&&i.a.createElement(h.Image,{image:r,x:c.width+l,y:l,width:l,height:d-2*l,opacity:o.opacity,scaleX:-1,offsetX:l}),n&&i.a.createElement(h.Image,{image:n,x:l,y:d-l,width:c.width,height:l,opacity:o.opacity,scaleY:-1,offsetY:l}),a&&i.a.createElement(h.Image,{image:a,x:l,y:0,width:c.width,height:l,opacity:o.opacity,scaleY:-1,offsetY:l}))}}]),a}(n.Component),w=a(13).ConfiguratorContext,_=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.context,t=e.uploadedImage,a=e.imageProps,n=e.rectStrokeWidth,r=e.updateImageProps,o=e.selectedItem,c=e.rootElemDimensions,s=e.stageRef,l=e.handleSelectedItem,d=e.checkDeselect,u=e.formatRatio,m=e.slicedImage,g=e.slicedImageBottom,p=e.slicedImageTop,f=e.slicedImageRight,w=e.outerCanvas,_=e.canvasPadding,x=this.props.stageConf,k=x.effectChoices.filter((function(e){return e.selected}))[0].value,E=c.height/u+2*_,I=(c.height,x.edgeChoices.filter((function(e){return e.selected}))[0]);return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{id:"outer-canvas-stage",style:{position:"absolute"}},i.a.createElement(h.Stage,{width:c.width+2*_,height:E},t&&"Stretched"===I.value&&i.a.createElement(C,{slicedImage:m,slicedImageTop:p,slicedImageBottom:g,slicedImageRight:f,outerCanvas:w,rootElemDimensions:c,formatRatio:u,canvasPadding:_}),t&&"Mirrored"===I.value&&i.a.createElement(y,{slicedImage:m,slicedImageTop:p,slicedImageBottom:g,slicedImageRight:f,outerCanvas:w,rootElemDimensions:c,formatRatio:u,canvasPadding:_}),t&&["Black","White"].includes(I.value)&&i.a.createElement(b,{outerCanvas:w,rootElemDimensions:c,formatRatio:u,canvasPadding:_,colorChoice:I.value.toLowerCase()}))),i.a.createElement("div",{id:"canvas-stage",style:{marginLeft:_+20+"px",marginTop:_+20+"px"}},i.a.createElement(h.Stage,{ref:s,width:c.width,height:c.height/u,onMouseDown:d,onTouchStart:d},i.a.createElement(h.Layer,null,i.a.createElement(h.Rect,{x:0,y:0,width:c.width,height:c.height/u,stroke:"white",strokeWidth:n,onClick:function(e){return d(e,!0)}})),i.a.createElement(h.Layer,null,t?i.a.createElement(v,{uploadedImage:t,imageProps:a,isSelected:"image"===o,onSelect:function(){l("image")},onChange:function(e){console.log({newAttrs2:e}),console.log("updateImageProps:start"),r(e)},colorChoice:k}):i.a.createElement(i.a.Fragment,null)))))}}]),a}(i.a.Component);_.contextType=w;var x=_,k=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"item-configuration-card"},i.a.createElement("h3",{className:"title"},i.a.createElement("label",{className:"StepsCount"},this.props.title)),this.props.subtitle&&i.a.createElement("p",null,this.props.subtitle),this.props.children)}}]),a}(n.Component),E=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.formatChoices,a=e.stage_id,n=this.context.handleFormatChoiceChange;return i.a.createElement(k,{title:"1 ) Choose the format: ",subtitle:"The image resolution (600 \xd7 337 pixels) allows the following print formats:"},i.a.createElement("table",{className:"table -striped -centered -selection format-table"},i.a.createElement("thead",{className:"table-tablehead"},i.a.createElement("tr",null,i.a.createElement("th",null,"Choice"),i.a.createElement("th",{className:"-discounted"},"Format"))),i.a.createElement("tbody",null,t.map((function(e){return i.a.createElement("tr",{className:e.selected?"selected":"","data-clickarea":"data-clickarea","data-frame":"formats",key:"format-".concat(e.value),onClick:function(){return n(a,e.value)}},i.a.createElement("td",null,i.a.createElement("input",{name:"itemConfiguratorForm:formatRadios",type:"radio",checked:e.selected,onChange:function(){return n(a,e.value)}})),i.a.createElement("td",null,i.a.createElement("label",null,e.name)))})))))}}]),a}(n.Component);E.contextType=u.ConfiguratorContext;var I=E,j=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.thicknessChoices,a=e.stage_id,n=this.context.handleThicknessChoiceChange;return i.a.createElement(k,{title:"2 ) Choose the thickness of the frame:"},i.a.createElement("div",{className:"clearfix select-image-container"},t.map((function(e){return i.a.createElement("div",{key:"thickness-".concat(e.value),className:"selectable imageEffectsBox ".concat(e.selected?"active":""),"data-clickarea":"data-clickarea",onClick:function(){return n(a,e.value)}},i.a.createElement("img",{className:"img-resposive",src:e.image,alt:"choose thickness"}),i.a.createElement("div",{className:"details"},i.a.createElement("input",{name:"itemConfiguratorForm:thickness",type:"radio",checked:e.selected,onChange:function(){return n(a,e.value)}}),i.a.createElement("span",{className:"image-item-name"},e.name)))}))))}}]),a}(n.Component);j.contextType=u.ConfiguratorContext;var O=j,R=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.effectChoices,a=e.stage_id,n=this.context.handleEffectChoiceChange;return i.a.createElement(k,{title:"4 ) Choose an effect:"},i.a.createElement("div",{className:"clearfix select-image-container"},t.map((function(e){return i.a.createElement("div",{key:"effect-".concat(e.value),className:"selectable imageEffectsBox ".concat(e.selected?"active":""),"data-clickarea":"data-clickarea",onClick:function(){return n(a,e.value)}},i.a.createElement("img",{className:"img-resposive",src:e.image,alt:"choose effect"}),i.a.createElement("div",{className:"details"},i.a.createElement("input",{name:"itemConfiguratorForm:effect",type:"radio",value:"null",checked:e.selected}),i.a.createElement("span",{className:"image-item-name"},e.name)))}))))}}]),a}(n.Component);R.contextType=u.ConfiguratorContext;var S=R,T=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.edgeChoices,a=e.stage_id,n=this.context.handleEdgeChoiceChange,r=[];return t.length>3&&(r.push(t.slice(0,3)),r.push(t.slice(3,t.length))),i.a.createElement(k,{title:"3 ) Choose the edge:"},r.map((function(e,t){return i.a.createElement("div",{className:"clearfix select-image-container ".concat(t>0?"margin-top":""),key:"twoDArray-"+t},e.map((function(e){return i.a.createElement("div",{key:"choose-edge-".concat(e.value),className:"selectable imageEffectsBox ".concat(e.selected?"active":""),"data-clickarea":"data-clickarea",onClick:function(){return n(a,e.value)}},i.a.createElement("img",{className:"img-resposive",src:e.image,alt:"choose edge"}),i.a.createElement("div",{className:"details"},i.a.createElement("input",{name:"itemConfiguratorForm:edge",type:"radio",value:"null",checked:e.selected}),i.a.createElement("span",{className:"image-item-name"},e.name)))})))})))}}]),a}(n.Component);T.contextType=u.ConfiguratorContext;var P=T;function D(e){return i.a.createElement("div",{id:"loading"},i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 4335 4335",width:"100",height:"100"},i.a.createElement("path",{fill:"#008DD2",d:"M3346 1077c41,0 75,34 75,75 0,41 -34,75 -75,75 -41,0 -75,-34 -75,-75 0,-41 34,-75 75,-75zm-1198 -824c193,0 349,156 349,349 0,193 -156,349 -349,349 -193,0 -349,-156 -349,-349 0,-193 156,-349 349,-349zm-1116 546c151,0 274,123 274,274 0,151 -123,274 -274,274 -151,0 -274,-123 -274,-274 0,-151 123,-274 274,-274zm-500 1189c134,0 243,109 243,243 0,134 -109,243 -243,243 -134,0 -243,-109 -243,-243 0,-134 109,-243 243,-243zm500 1223c121,0 218,98 218,218 0,121 -98,218 -218,218 -121,0 -218,-98 -218,-218 0,-121 98,-218 218,-218zm1116 434c110,0 200,89 200,200 0,110 -89,200 -200,200 -110,0 -200,-89 -200,-200 0,-110 89,-200 200,-200zm1145 -434c81,0 147,66 147,147 0,81 -66,147 -147,147 -81,0 -147,-66 -147,-147 0,-81 66,-147 147,-147zm459 -1098c65,0 119,53 119,119 0,65 -53,119 -119,119 -65,0 -119,-53 -119,-119 0,-65 53,-119 119,-119z"})),i.a.createElement("div",{className:"loading-text"},"Saving ",e.currentUploading,"/",e.totalImageCount," ..."))}var N=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).fileRef=i.a.createRef(),e.triggerInputFile=function(){e.fileRef.current.click()},e.handleCanvasScale=function(t){var a=t.currentTarget.value;e.context.imageProps&&e.context.handleCanvasImageZoomScale(a)},e.handleCanvasScaleOnDragEnd=function(t){var a=t.currentTarget.value,n=e.context,i=n.updateImageProps,r=n.originalImageProps,o=n.imageProps;if(o){var c=Object.assign({},r),s=1+a/30;c.height=c.height*s,c.width=c.width*s;var l=document.getElementById("canvas-stage").getBoundingClientRect(),d=Object(f.a)(l,o,{x:o.x,y:o.y});c.x=d.x,c.y=d.y,i(c)}},e.handleGoToCart=function(){window.location.href="/cart"},e}return Object(s.a)(a,[{key:"render",value:function(){var e,t=this.context,a=t.stages,n=t.handleImageUpload,r=t.imageZoomScale,o=(t.handleExport,t.handleUpdateCart),c=t.isLoading,s=t.imageProps,l=t.product,d=t.variant,u=t.totalImageCount,h=t.currentUploading,m=t.imagesToAdd,g=a[0],p=g.formatChoices.filter((function(e){return e.selected}))[0].name;if(l&&d){var f=l.variants.filter((function(e){return e.id==d}));f.length&&(e=f[0].price)}return i.a.createElement("div",{className:"canvas-flex-wrapper"},c&&i.a.createElement(D,{totalImageCount:u,currentUploading:h}),i.a.createElement("div",{className:"canvas-form-left"},i.a.createElement(I,{formatChoices:g.formatChoices,stage_id:g.stage_id}),i.a.createElement(O,{thicknessChoices:g.thicknessChoices,stage_id:g.stage_id}),i.a.createElement(P,{edgeChoices:g.edgeChoices,stage_id:g.stage_id}),i.a.createElement(S,{effectChoices:g.effectChoices,stage_id:g.stage_id})),i.a.createElement("div",{className:"canvas-form-right",id:"configurator-canvas-body"},i.a.createElement("p",{id:"bleeding-area-top"},"Size: ",p),i.a.createElement(x,{stageConf:g}),i.a.createElement("span",{className:"scaleCanvasPage"},i.a.createElement("span",null,"Zoom: "),i.a.createElement("input",{type:"range",className:"scaleCanvas",value:r,min:"0",max:"30",onInput:this.handleCanvasScaleOnDragEnd,onChange:this.handleCanvasScale})),i.a.createElement("div",{className:"configurator-select-file"},null!==typeof e&&i.a.createElement("div",{className:"price-block"},i.a.createElement("span",null,"Price"),i.a.createElement("span",null,"$",e)),i.a.createElement("input",{ref:this.fileRef,type:"file",name:"upload",id:"configurator_file_upload",onChange:function(e){return n(e,null,g.stage_id)}}),i.a.createElement("button",{className:"configurator-select-file-btn btn btn-primary",onClick:this.triggerInputFile},s?"Change Photo ".concat(h,"/").concat(u):"Upload Photo ".concat(h,"/").concat(u)),i.a.createElement("button",{className:"btn btn-primary",id:"download-btn",onClick:o},"Save to cart"),i.a.createElement("button",{className:"btn btn-primary",id:"go-to-cart",disabled:!(u==h&&!m.length),onClick:this.handleGoToCart},"Go to cart"))))}}]),a}(n.Component);N.contextType=u.ConfiguratorContext;var B=N,U=function(e){Object(l.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){return i.a.createElement(u.default,null,i.a.createElement(B,null))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},13:function(e,t,a){"use strict";a.r(t),a.d(t,"ConfiguratorContext",(function(){return b}));var n=a(18),i=a(14),r=a(15),o=a.n(r),c=a(19),s=a(21),l=a(5),d=a(6),u=a(17),h=a(8),m=a(7),g=a(0),p=a.n(g),f=a(20),v=a.n(f),C=a(16),b=Object(g.createContext)(),y={text:"",fontSize:30,x:100,y:100,draggable:!0,fill:"black",custom_id:1},w=function(e){Object(h.a)(r,e);var t=Object(m.a)(r);function r(e){var d;Object(l.a)(this,r),(d=t.call(this,e)).stageRef=p.a.createRef(),d.stageRef2=p.a.createRef(),d.updateImageProps=function(e){d.setState({imageProps:e},(function(){d.setCanvasBorders()}))},d.updateInitText=function(e,t){for(var a=d.state.textInputs,n=0;n<a.length;n++)if(a[n].custom_id===t){a[n]=e;break}d.setState({textInputs:a})},d.handleSelectedItem=function(e){},d.handleImageUpload=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t&&e){var n=window.webkitURL||window.URL;if(!e.target.files||!e.target.files[0])return;t=n.createObjectURL(e.target.files[0])}var i=new Image;i.crossOrigin="Anonymous",i.src=t;var r=Object(u.a)(d),o=d.state.rootElemDimensions,c=d.state.stages;i.onload=function(){var e=i.width,t=i.height,n=Object(C.b)(o,e,t);r.setState({uploadedImage:i,pixelRatio:n.ratio,imageProps:{x:0,y:0,width:n.img_width,height:n.img_height,draggable:!0,rotation:0},originalImageProps:{x:0,y:0,width:n.img_width,height:n.img_height,draggable:!0,rotation:0}});var s=c.filter((function(e){return e.stage_id==a}))[0].formatChoices.filter((function(e){return e.selected}))[0];r.handleFormatChoiceChange(a,s.value)}},d.setStretchedCanvasBorders=function(e,t){var a=Object(u.a)(d);d.stageRef.current.toImage({x:0,y:0,width:1,height:t,callback:function(e){a.setState({slicedImage:e})}}),d.stageRef.current.toImage({x:e,y:0,width:1,height:t,callback:function(e){a.setState({slicedImageRight:e})}}),d.stageRef.current.toImage({x:0,y:t-1,width:e,height:1,callback:function(e){a.setState({slicedImageBottom:e})}}),d.stageRef.current.toImage({x:0,y:1,width:e,height:1,callback:function(e){a.setState({slicedImageTop:e})}})},d.setMirroredCanvasBorders=function(e,t){var a=d.state.canvasPadding,n=Object(u.a)(d);d.stageRef.current.toImage({x:0,y:0,width:a,height:t,callback:function(e){n.setState({slicedImage:e})}}),d.stageRef.current.toImage({x:e-a,y:0,width:a,height:t,callback:function(e){n.setState({slicedImageRight:e})}}),d.stageRef.current.toImage({x:0,y:t-a,width:e,height:a,callback:function(e){n.setState({slicedImageBottom:e})}}),d.stageRef.current.toImage({x:0,y:0,width:e,height:a,callback:function(e){n.setState({slicedImageTop:e})}})},d.setCanvasBorders=function(){var e=d.state.rootElemDimensions,t=d.state.formatRatio,a=e.width,n=e.height/t,i=d.state.stages[0].edgeChoices.filter((function(e){return e.selected}))[0];"Stretched"===i.value?d.setStretchedCanvasBorders(a,n):"Mirrored"===i.value&&d.setMirroredCanvasBorders(a,n)},d.handleChoiceChange=function(e,t,a){console.log("handleChoiceChange:start");var n,i=d.state.stages,r=Object(s.a)(i);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.stage_id===e){var c,l=Object(s.a)(o[a]);try{for(l.s();!(c=l.n()).done;){var u=c.value;u.value===t?u.selected=!0:u.selected=!1}}catch(g){l.e(g)}finally{l.f()}break}}}catch(g){r.e(g)}finally{r.f()}var h={stages:i};if("thicknessChoices"===a){var m=2===Number(t)?10:20;h.canvasPadding=m}d.setState(h,(function(){"edgeChoices"!==a&&"effectChoices"!==a||d.setCanvasBorders()}))},d.handleFormatChoiceChange=function(e,t){var a=d.state,n=a.rootElemDimensions,i=a.originalImageProps,r=t.split("x").map((function(e){return Number(e)})),o=r[0]/r[1],c=document.getElementById("canvas-stage");if(c&&(c.style.height=n.height/o+"px"),d.handleChoiceChange(e,t,"formatChoices"),c&&(n=c.getBoundingClientRect()),i){var s=Object(C.b)(n,i.width,i.height);d.setState({formatRatio:o,imageZoomScale:0,imageProps:{x:0,y:0,width:s.img_width,height:s.img_height,draggable:!0,rotation:0},originalImageProps:{x:0,y:0,width:s.img_width,height:s.img_height,draggable:!0,rotation:0}},(function(){d.setCanvasBorders()}))}else d.setState({formatRatio:o,imageZoomScale:0},(function(){d.setCanvasBorders()}))},d.handleCanvasImageZoomScale=function(e){d.setState({imageZoomScale:e})},d.handleThicknessChoiceChange=function(e,t){d.handleChoiceChange(e,t,"thicknessChoices")},d.handleEffectChoiceChange=function(e,t){d.handleChoiceChange(e,t,"effectChoices")},d.handleEdgeChoiceChange=function(e,t){d.handleChoiceChange(e,t,"edgeChoices")},d.handleAddMoreTextField=function(){var e=d.state.textInputs,t=1;e.length&&(t=e[e.length-1].custom_id+1);var a=Object.assign({},y);a.custom_id=t,e.push(a),d.setState({textInputs:e})},d.checkDeselect=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.target===e.target.getStage();t&&(a=!0),a&&d.setState({selectedItem:""})},d.base64ToBlob=function(e,t){t=t||"";for(var a=window.atob(e),n=[],i=0,r=a.length;i<r;i+=1024){for(var o=a.slice(i,i+1024),c=new Array(o.length),s=0;s<o.length;s++)c[s]=o.charCodeAt(s);var l=new Uint8Array(c);n.push(l)}return new Blob(n,{type:t})},d.handleExport=function(){var e=d.stageRef.current.toDataURL({pixelRatio:d.state.pixelRatio}).replace(/^data:image\/(png|jpg);base64,/,""),t=d.base64ToBlob(e,"image/png");d.handleFileUpload(t,"stage.png")},d.handleFileUpload=function(e,t){return console.log("handleFileUpload:start"),new Promise(function(){var a=Object(c.a)(o.a.mark((function a(n,i){var r,c;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,!e){a.next=11;break}return(r=new FormData).append("naeco_files",e,t),a.next=6,v.a.post("https://customiser.rebornmerchandise.com/upload/v2",r,{headers:{"Content-Type":"multipart/form-data"}});case 6:return c=a.sent,console.log(c),a.abrupt("return",n(c.data.file));case 11:i("file not found");case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(0),i(a.t0);case 17:case"end":return a.stop()}}),a,null,[[0,14]])})));return function(e,t){return a.apply(this,arguments)}}())},d.getProductDetails=function(){var e=d.state.handle;v.a.get("/products/".concat(e,".json")).then((function(e){(e=e.data).product&&(e=e.product),d.setState({product:e})})).catch((function(e){return console.log(e)}))},d.initialCartSetup=function(){window.$&&window.$.getJSON&&window.$.getJSON("/cart.js").done((function(e){e&&(d.setState({cart:e,totalImageCount:4}),d.setupImagesFromCart(e,4))})).fail((function(){var e=a(75);d.setState({totalImageCount:2,cart:e}),d.setupImagesFromCart(e,4)}))},d.setupImagesFromCart=function(e,t){for(var a=d.state,n=(a.cartCurrentKeyItem,a.edit),i=a.variant,r=a.itemIndex,o=a.image_index,c=1,l={},u=1;u<=t;u++)l["_image"+u]=1;var h=null,m=!1;if(!isNaN(r)&&!0===n&&e&&e.items&&e.items.length){var g,p=Object(s.a)(e.items);try{for(p.s();!(g=p.n()).done;){var f=g.value;if(f.variant_id==i&&(!0,f.properties))for(var v in f.properties){if(o&&(c=o.split(" ")[1],h=f.properties["_image"+c]?f.properties["_image"+c].src:"")){m=!0;break}v in l&&(delete l[v],h=f.properties[v].src)}}}catch(C){p.e(C)}finally{p.f()}}l=Object.keys(l),m||(c=l.length?Number(l[0].replace("_image","")):t),console.log({imagesToAdd:l,currentUploading:c,c:c}),d.setState({imagesToAdd:l,currentUploading:c,lastImageSrc:h}),(m||!l.length&&h)&&d.handleImageUpload(null,h)},d.updateCartItemProperties=Object(c.a)(o.a.mark((function e(){var t,a,r,c,l,u,h,m,g,p,f,v,C,b,y,w,_,x,k,E,I,j,O;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updateCartItemProperties:start"),e.prev=1,d.setState({isLoading:!0}),a=d.stageRef.current.toDataURL({pixelRatio:d.state.pixelRatio}),r=a.replace(/^data:image\/(png|jpg);base64,/,""),c=d.base64ToBlob(r,"image/png"),l=d.state,u=l.stages,h=l.cart,l.cartCurrentKeyItem,m=l.currentUploading,g=l.variant,p=l.edit,f=u[0],v=f.effectChoices,C=f.edgeChoices,b=f.thicknessChoices,y=f.formatChoices,v=v.filter((function(e){return e.selected})),C=C.filter((function(e){return e.selected})),b=b.filter((function(e){return e.selected})),y=y.filter((function(e){return e.selected})),w=1,_={},!h||!h.items){e.next=34;break}x=Object(s.a)(h.items),e.prev=16,x.s();case 18:if((k=x.n()).done){e.next=26;break}if((E=k.value).variant_id!=g){e.next=23;break}return _=E.properties||{},e.abrupt("break",26);case 23:w++;case 24:e.next=18;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(16),x.e(e.t0);case 31:return e.prev=31,x.f(),e.finish(31);case 34:return e.next=36,d.handleFileUpload(c,"stage.png");case 36:if(I=e.sent,console.log({existingProperties:_,currentUploading:m}),j=Object(i.a)(Object(i.a)({},_),{},(t={},Object(n.a)(t,"image "+m,I),Object(n.a)(t,"_image"+m,{src:I,format:y[0].value,thickness:b[0].value,edge:C[0].value,effect:v[0].value}),t)),console.log({propertiesToAdd:j}),O=d.getUpdatedURLWithQueryParams(w,g),console.log("Page will be reloaded... ".concat(O)),!0!==p){e.next=50;break}return console.log("edit is set to true"),e.next=46,d.updateCart(w,j);case 46:e.sent,console.log("item updated.. need to reload the page by setitng edit=yes and index of item being edited"),e.next=53;break;case 50:console.log("edit is set to false"),d.addToCart(g,j),console.log("item added to cart.. need to reload the page by setting edit=yes and index of item being edited = 0");case 53:window.location.href=O,e.next=59;break;case 56:e.prev=56,e.t1=e.catch(1),console.error(e.t1);case 59:return e.prev=59,d.setState({isLoading:!1}),e.finish(59);case 62:case"end":return e.stop()}}),e,null,[[1,56,59,62],[16,28,31,34]])}))),d.updateCart=function(e,t){return console.log("updateCart:start"),new Promise(function(){var a=Object(c.a)(o.a.mark((function a(n,i){var r;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,v.a.post("/cart/change.js",{line:e,properties:t});case 3:r=a.sent,console.log({cartUpdated:r}),n(r.data),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),i(a.t0);case 11:case"end":return a.stop()}}),a,null,[[0,8]])})));return function(e,t){return a.apply(this,arguments)}}())},d.addToCart=function(e,t){return console.log("addToCart:start"),new Promise(function(){var a=Object(c.a)(o.a.mark((function a(n,i){var r;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,v.a.post("/cart/add.js",{quantity:1,id:e,properties:t});case 3:r=a.sent,n(r.data),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),i(a.t0);case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));return function(e,t){return a.apply(this,arguments)}}())},d.getUpdatedURLWithQueryParams=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,a=new URLSearchParams(window.location.search);return a.set("edit","yes"),a.set("index",e),a.set("variant",t),a.set("image_index",""),window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+a.toString()},d.handleUpdateCart=function(){console.log("handleUpdateCart:start"),d.updateCartItemProperties()},document.getElementsByName("viewport");var h,m,g,f=new URLSearchParams(window.location.search),b=!1,w=1,_=null;return f&&(h=f.get("variant"),b="yes"===f.get("edit"),w=Number(f.get("index")||1),_=f.get("key"),m=f.get("handle"),g=f.get("image_index")),d.state={outerCanvas:{width:500,height:500,opacity:.5},innerCanvas:{width:480,height:480},canvasPadding:10,isLoading:!1,variant:h,itemIndex:w,edit:b,image_index:g,totalImageCount:1,cartCurrentKeyItem:_,currentUploading:1,imagesToAdd:[],lastImageSrc:null,originalImageProps:null,cart:null,handle:m,product:null,imageProps:null,uploadedImage:null,initText:y,textInputs:[y],rectStrokeWidth:1,selectedItem:"",rootElemDimensions:{width:460,height:460},pixelRatio:1,formatRatio:1,imageZoomScale:0,stages:[{stage_id:1,imageProps:null,uploadedImage:null,initText:y,rectStrokeWidth:1,selectedItem:"",rootElemDimensions:{},formatChoices:[{name:"200x200 mm",value:"200x200",selected:!0},{name:"210x297 mm",value:"210x297",selected:!1},{name:"300x200 mm",value:"300x200",selected:!1},{name:"400x400 mm",value:"400x400",selected:!1},{name:"300x400 mm",value:"300x400",selected:!1}],thicknessChoices:[{name:"2 cm (Standard)",value:"2",selected:!0,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Keilrahmen-10.jpg"},{name:"4 cm (XXL)",value:"4",selected:!1,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Keilrahmen-11.jpg"}],edgeChoices:[{name:"Stretched",value:"Stretched",selected:!0,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Rand-Design-stretched.jpg"},{name:"Mirrored",value:"Mirrored",selected:!1,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Rand-Design-mirrored.jpg"},{name:"Black",value:"Black",selected:!1,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Rand-Design-black.jpg"},{name:"White",value:"White",selected:!1,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Rand-Design-white.jpg"}],effectChoices:[{name:"Nobody",value:"nb",selected:!0,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Bildeffekt-null.jpg"},{name:"Black and white",value:"bw",selected:!1,image:"https://www.stampa-su-tela.it/staticimages/configurator/stampa-it/Bildeffekt-black_and_white.jpg"}]}]},d}return Object(d.a)(r,[{key:"componentDidMount",value:function(){this.initialCartSetup(),this.getProductDetails()}},{key:"downloadURI",value:function(e,t){var a=document.createElement("a");a.download=t,a.href=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},{key:"render",value:function(){return p.a.createElement(b.Provider,{value:Object(i.a)(Object(i.a)({},this.state),{},{updateImageProps:this.updateImageProps,updateInitText:this.updateInitText,handleImageUpload:this.handleImageUpload,handleSelectedItem:this.handleSelectedItem,checkDeselect:this.checkDeselect,downloadURI:this.downloadURI,handleExport:this.handleExport,stageRef:this.stageRef,handleCanvasImageZoomScale:this.handleCanvasImageZoomScale,handleFormatChoiceChange:this.handleFormatChoiceChange,handleThicknessChoiceChange:this.handleThicknessChoiceChange,handleEdgeChoiceChange:this.handleEdgeChoiceChange,handleEffectChoiceChange:this.handleEffectChoiceChange,handleAddMoreTextField:this.handleAddMoreTextField,handleUpdateCart:this.handleUpdateCart})},this.props.children)}}]),r}(g.Component);t.default=w},16:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return i}));var n=function(e,t,a){var n=Math.min(e.width,e.height),i=Math.min(a,t),r=1,o=e.width/e.height-t/a;return t>a?(console.log("first if"),e.width>e.height?(console.log("if if"),r=t/e.width):(console.log("if else"),r=a/e.height)):(console.log("first else"),e.width>=e.height?(console.log("else if"),r=t/e.width):(console.log("else else"),r=t*(1+o)/e.width)),console.log({diffRatio:o,ratio:r}),{img_width:t/=r,img_height:a/=r,lowestElemDimension:n,lowestImgDimension:i,ratio:r}},i=function(e,t,a){var n=e.width-t.width,i=e.height-t.height;return Math.abs(a.x)>Math.abs(n)?a.x>0?a.x=0:a.x=n:a.x>0&&(a.x=0),a.y>0?a.y=0:Math.abs(a.y)>Math.abs(i)&&(a.y=i),a}},50:function(e,t,a){e.exports=a(121)},54:function(e,t,a){},55:function(e,t,a){},75:function(e){e.exports=JSON.parse('{"token":"db453936efa777e4c23e0bd975772b3f","note":null,"attributes":{},"original_total_price":30000,"total_price":30000,"total_discount":0,"total_weight":0,"item_count":3,"items":[{"id":37601534050463,"properties":{"_image1":{"src":"https://cdn.shopify.com/s/files/1/0313/9849/4347/products/1610911742499-stage.png?v=1610911745","format":"200x200","thickness":"2","edge":"Stretched","effect":"nb"},"image 1":"https://cdn.shopify.com/s/files/1/0313/9849/4347/products/1610911742499-stage.png?v=1610911745"},"quantity":1,"variant_id":37601534050463,"key":"37601534050463:b5907dd30e5fe1d1ea3059c38ead994f","title":"Test Product 2","price":10000,"original_price":10000,"discounted_price":10000,"line_price":10000,"original_line_price":10000,"total_discount":0,"discounts":[],"sku":null,"grams":0,"vendor":"codecrux","taxable":true,"product_id":6100390084767,"product_has_only_default_variant":true,"gift_card":false,"final_price":10000,"final_line_price":10000,"url":"/products/test-product-2?variant=37601534050463","featured_image":{"aspect_ratio":1.4,"alt":"Test Product 2","height":1286,"url":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1_46ee5e1a-647f-46c0-89a3-4b398b84c1af.jpg?v=1610907787","width":1800},"image":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1_46ee5e1a-647f-46c0-89a3-4b398b84c1af.jpg?v=1610907787","handle":"test-product-2","requires_shipping":true,"product_type":"","product_title":"Test Product 2","product_description":"Test Product Description","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":37601534050463,"properties":{"format_1":"200x200","thickness_1":"2","edge_1":"Stretched","effect_1":"nb","image_1":"https://cdn.shopify.com/s/files/1/0313/9849/4347/products/1610909679116-stage.png?v=1610909682"},"quantity":1,"variant_id":37601534050463,"key":"37601534050463:8b6e29552739290dec338a5aad8d2a07","title":"Test Product 2","price":10000,"original_price":10000,"discounted_price":10000,"line_price":10000,"original_line_price":10000,"total_discount":0,"discounts":[],"sku":null,"grams":0,"vendor":"codecrux","taxable":true,"product_id":6100390084767,"product_has_only_default_variant":true,"gift_card":false,"final_price":10000,"final_line_price":10000,"url":"/products/test-product-2?variant=37601534050463","featured_image":{"aspect_ratio":1.4,"alt":"Test Product 2","height":1286,"url":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1_46ee5e1a-647f-46c0-89a3-4b398b84c1af.jpg?v=1610907787","width":1800},"image":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1_46ee5e1a-647f-46c0-89a3-4b398b84c1af.jpg?v=1610907787","handle":"test-product-2","requires_shipping":true,"product_type":"","product_title":"Test Product 2","product_description":"Test Product Description","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0},{"id":37221627035807,"properties":{"format":"200x200","thickness":"4","edge":"Mirrored","effect":"nb","image_1":"https://cdn.shopify.com/s/files/1/0313/9849/4347/products/1610907422935-stage.png?v=1610907425"},"quantity":1,"variant_id":37221627035807,"key":"37221627035807:77d23bfc0a0519db03558981ccb6d2ef","title":"Test Product","price":10000,"original_price":10000,"discounted_price":10000,"line_price":10000,"original_line_price":10000,"total_discount":0,"discounts":[],"sku":"","grams":0,"vendor":"codecrux","taxable":true,"product_id":5976266473631,"product_has_only_default_variant":true,"gift_card":false,"final_price":10000,"final_line_price":10000,"url":"/products/test-product?variant=37221627035807","featured_image":{"aspect_ratio":1.4,"alt":"Test Product","height":1286,"url":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1.jpg?v=1607397675","width":1800},"image":"https://cdn.shopify.com/s/files/1/0512/9990/9791/products/sketch_1.jpg?v=1607397675","handle":"test-product","requires_shipping":true,"product_type":"","product_title":"Test Product","product_description":"Test Product Description","variant_title":null,"variant_options":["Default Title"],"options_with_values":[{"name":"Title","value":"Default Title"}],"line_level_discount_allocations":[],"line_level_total_discount":0}],"requires_shipping":true,"currency":"USD","items_subtotal_price":30000,"cart_level_discount_applications":[]}')}},[[50,1,2]]]);
//# sourceMappingURL=main.f61683d1.chunk.js.map